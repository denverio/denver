#!/usr/bin/env sh

denver_main() {
  local project=$(echo $1 | tr '_' '-' | sed 's/\([A-Z]\)/\-\L\1/g')
  local projectCommand="$DENVER_HOME/$project/.denver/bin/$(echo $project | tr '-' '_')"

  [ $# -ne 0 ] && shift

  if [ -s "$projectCommand" ]
  then
    echo $projectCommand
  else
    echo "$projectCommand not found!"
    exit 1
  fi

  if [ -s "$DENVER_HOME/.env" ] 
  then
    eval $(env "$(cat "$DENVER_HOME/.env"; env)" | grep -E '^(DE_|DOCKER_)' | sed 's/^\(.\+=\)\("\?\)\([^"$]\+\)\("\?\)$/export \1"\3"/')
  fi

  env sh -c "$projectCommand $(echo "$@")"

  exit 0
}
denver_main "$@"

